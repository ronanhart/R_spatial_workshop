<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Spatial Data in R | R Spatial Workshop</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Spatial Data in R | R Spatial Workshop" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="ronanhart/R_spatial_workshop" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Spatial Data in R | R Spatial Workshop" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Ronan Hart" />


<meta name="date" content="2022-04-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="gis-basics.html"/>
<link rel="next" href="spatial-analysis.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Ecology Center: R Spatial Workshop</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome to the Ecology Center’s Workshop on R Spatial!<span></span></a>
<ul>
<li><a href="index.html#why-gis-in-r">Why GIS in R?<span></span></a></li>
<li><a href="index.html#prerequisites-packages-and-preparation">Prerequisites, Packages, and Preparation<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="gis-basics.html"><a href="gis-basics.html"><i class="fa fa-check"></i><b>2</b> GIS basics<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="gis-basics.html"><a href="gis-basics.html#datums-projections-and-coordinate-systems"><i class="fa fa-check"></i><b>2.1</b> Datums, Projections, and Coordinate Systems<span></span></a>
<ul>
<li><a href="gis-basics.html#datums">Datums<span></span></a></li>
<li><a href="gis-basics.html#projections">Projections<span></span></a></li>
<li><a href="gis-basics.html#coordinate-reference-system">Coordinate Reference System<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="gis-basics.html"><a href="gis-basics.html#spatial-data"><i class="fa fa-check"></i><b>2.2</b> Spatial Data<span></span></a>
<ul>
<li><a href="gis-basics.html#vectors">Vectors<span></span></a></li>
<li><a href="gis-basics.html#rasters">Rasters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="gis-basics.html"><a href="gis-basics.html#vectors-vs-rasters-pros-cons"><i class="fa fa-check"></i><b>2.3</b> Vectors vs Rasters: pros &amp; cons<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html"><i class="fa fa-check"></i><b>3</b> Spatial Data in R<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#vectors-1"><i class="fa fa-check"></i><b>3.1</b> Vectors<span></span></a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#loading-vector-data-from-a-spreadsheet"><i class="fa fa-check"></i><b>3.1.1</b> Loading vector data from a spreadsheet<span></span></a></li>
<li class="chapter" data-level="3.1.2" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#loading-vector-data"><i class="fa fa-check"></i><b>3.1.2</b> Loading vector data<span></span></a></li>
<li class="chapter" data-level="3.1.3" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#projecting-vector-data"><i class="fa fa-check"></i><b>3.1.3</b> Projecting vector data<span></span></a></li>
<li class="chapter" data-level="3.1.4" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#saving-vector-data"><i class="fa fa-check"></i><b>3.1.4</b> Saving vector data<span></span></a></li>
<li class="chapter" data-level="3.1.5" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#converting-between-sf-and-sp"><i class="fa fa-check"></i><b>3.1.5</b> Converting between <code>sf</code> and <code>sp</code><span></span></a></li>
<li><a href="spatial-data-in-r.html#a-note-about-sf-and-tidyverse">A note about <code>sf</code> and <code>tidyverse</code><span></span></a></li>
<li><a href="spatial-data-in-r.html#your-turn">Your Turn!<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#rasters-1"><i class="fa fa-check"></i><b>3.2</b> Rasters<span></span></a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#load-a-raster"><i class="fa fa-check"></i><b>3.2.1</b> Load a raster<span></span></a></li>
<li class="chapter" data-level="3.2.2" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#create-a-raster"><i class="fa fa-check"></i><b>3.2.2</b> Create a raster<span></span></a></li>
<li class="chapter" data-level="3.2.3" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#project-a-raster"><i class="fa fa-check"></i><b>3.2.3</b> Project a raster<span></span></a></li>
<li class="chapter" data-level="3.2.4" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#save-a-raster"><i class="fa fa-check"></i><b>3.2.4</b> Save a raster<span></span></a></li>
<li><a href="spatial-data-in-r.html#your-turn-1">Your Turn!<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spatial-analysis.html"><a href="spatial-analysis.html"><i class="fa fa-check"></i><b>4</b> Spatial Analysis<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="spatial-analysis.html"><a href="spatial-analysis.html#selecting-attributes"><i class="fa fa-check"></i><b>4.1</b> Selecting Attributes<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="spatial-analysis.html"><a href="spatial-analysis.html#select-features-by-location"><i class="fa fa-check"></i><b>4.2</b> Select features by location<span></span></a></li>
<li class="chapter" data-level="4.3" data-path="spatial-analysis.html"><a href="spatial-analysis.html#joining-attributes"><i class="fa fa-check"></i><b>4.3</b> Joining Attributes<span></span></a></li>
<li class="chapter" data-level="4.4" data-path="spatial-analysis.html"><a href="spatial-analysis.html#cropping"><i class="fa fa-check"></i><b>4.4</b> Cropping<span></span></a>
<ul>
<li><a href="spatial-analysis.html#cropping-a-vector">Cropping a vector<span></span></a></li>
<li><a href="spatial-analysis.html#cropping-a-raster">Cropping a raster<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="spatial-analysis.html"><a href="spatial-analysis.html#extract-raster-values"><i class="fa fa-check"></i><b>4.5</b> Extract Raster Values<span></span></a></li>
<li class="chapter" data-level="4.6" data-path="spatial-analysis.html"><a href="spatial-analysis.html#distance"><i class="fa fa-check"></i><b>4.6</b> Distance<span></span></a></li>
<li class="chapter" data-level="4.7" data-path="spatial-analysis.html"><a href="spatial-analysis.html#raster-cell-stats"><i class="fa fa-check"></i><b>4.7</b> Raster Cell Stats<span></span></a></li>
<li class="chapter" data-level="4.8" data-path="spatial-analysis.html"><a href="spatial-analysis.html#calculate-terrain-characteristics"><i class="fa fa-check"></i><b>4.8</b> Calculate Terrain Characteristics<span></span></a></li>
<li class="chapter" data-level="4.9" data-path="spatial-analysis.html"><a href="spatial-analysis.html#a-note-about-loops"><i class="fa fa-check"></i><b>4.9</b> A Note About Loops<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="where-to-obtain-data-further-resources.html"><a href="where-to-obtain-data-further-resources.html"><i class="fa fa-check"></i><b>5</b> Where to Obtain Data &amp; Further Resources<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="where-to-obtain-data-further-resources.html"><a href="where-to-obtain-data-further-resources.html#data-sources"><i class="fa fa-check"></i><b>5.1</b> Data Sources<span></span></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="where-to-obtain-data-further-resources.html"><a href="where-to-obtain-data-further-resources.html#maps-package"><i class="fa fa-check"></i><b>5.1.1</b> <code>maps</code> package<span></span></a></li>
<li class="chapter" data-level="5.1.2" data-path="where-to-obtain-data-further-resources.html"><a href="where-to-obtain-data-further-resources.html#utah-gis"><i class="fa fa-check"></i><b>5.1.2</b> Utah GIS<span></span></a></li>
<li class="chapter" data-level="5.1.3" data-path="where-to-obtain-data-further-resources.html"><a href="where-to-obtain-data-further-resources.html#other-environmental-rasters"><i class="fa fa-check"></i><b>5.1.3</b> Other Environmental Rasters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="where-to-obtain-data-further-resources.html"><a href="where-to-obtain-data-further-resources.html#more-resources"><i class="fa fa-check"></i><b>5.2</b> More Resources<span></span></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="where-to-obtain-data-further-resources.html"><a href="where-to-obtain-data-further-resources.html#learn-more-about-gis-in-general"><i class="fa fa-check"></i><b>5.2.1</b> Learn more about GIS in general<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="where-to-obtain-data-further-resources.html"><a href="where-to-obtain-data-further-resources.html#acknowledgements"><i class="fa fa-check"></i><b>5.3</b> Acknowledgements<span></span></a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="where-to-obtain-data-further-resources.html"><a href="where-to-obtain-data-further-resources.html#figure-citations"><i class="fa fa-check"></i><b>5.3.1</b> Figure Citations<span></span></a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Spatial Workshop</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatial-data-in-r" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Spatial Data in R<a href="spatial-data-in-r.html#spatial-data-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="vectors-1" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Vectors<a href="spatial-data-in-r.html#vectors-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The primary packages that deal with these features are <a href="https://cran.r-project.org/web/packages/sf/index.html"><code>sf</code></a> and <a href="https://cran.r-project.org/web/packages/sp/index.html"><code>sp</code></a></p>
<p><strong>sf</strong> means “simple feature” while <strong>sp</strong> is short for “spatial.” There are pros and cons to both (for example, a lot of other packages depend on <code>sp</code>, <code>sf</code> works well in <code>tidyverse</code>, etc.). However, in my opinion, there is no reason that you can’t use both in the same code, if needed. <a href="https://cengel.github.io/R-spatial/intro.html#conceptualizing-spatial-vector-objects-in-r">This website</a> goes into more detail about these packages and the specifics about objects from these packages.</p>
<div id="loading-vector-data-from-a-spreadsheet" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Loading vector data from a spreadsheet<a href="spatial-data-in-r.html#loading-vector-data-from-a-spreadsheet" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You will often have a spreadsheet of data that have two columns of latitude and longitude (and potentially other columns for the attributes of these features).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="spatial-data-in-r.html#cb4-1" aria-hidden="true" tabindex="-1"></a>sites <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;Data/Examples/Sites.csv&quot;</span>)</span>
<span id="cb4-2"><a href="spatial-data-in-r.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sites)</span></code></pre></div>
<pre><code>##   Site Latitude Longitude
## 1    1 37.84203 -110.8090
## 2    2 39.04723 -111.3390
## 3    3 38.04543 -109.2163
## 4    4 39.71574 -113.1987
## 5    5 41.50760 -111.5509
## 6    6 38.75022 -111.5154</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="spatial-data-in-r.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sites)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<p>How can we convert this data table into a spatial object?</p>
<div id="with-sf" class="section level4 unnumbered hasAnchor">
<h4>With sf<a href="spatial-data-in-r.html#with-sf" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We’ll use the function <code>st_as_sf()</code> to convert an object of another class to an <code>sf</code> object. As with any function, you can always type <code>?st_as_sf</code> in the console to remind yourself what the function does and what arguments you need to add. In this case, the non-optional arguments are <code>x</code> (the object we want to convert, in this case our sites data frame) and <code>coords</code> (the columns in the data frame that have the coordinate data).</p>
<p>The argument <code>crs</code> is optional but we should add it so that our spatial object has a coordinate reference system. Because our coordinates are lat/long, we should tell <code>st_as_sf</code> that our crs is WGS84 lat/long (Remember that the EPSG code for WGS84 lat/long is <a href="https://www.spatialreference.org/ref/epsg/4326/">4326</a>). <strong>Note: Even if you’re working in a different geographic or projection coordinate system, it is ALWAYS good practice to load in lat/long coordinates as WGS84 lat/long and then later projecting the object, instead of right away giving it a projected coordinate system.</strong> This is because GPS coordinates work with a global datum (being a <strong>global</strong> positioning system), and you might have inaccurate positions if you load it in with another datum or projection.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="spatial-data-in-r.html#cb8-1" aria-hidden="true" tabindex="-1"></a>sites_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(sites, </span>
<span id="cb8-2"><a href="spatial-data-in-r.html#cb8-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;Latitude&quot;</span>), </span>
<span id="cb8-3"><a href="spatial-data-in-r.html#cb8-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb8-4"><a href="spatial-data-in-r.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sites_sf)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 1 field
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -113.1987 ymin: 37.84203 xmax: -109.2163 ymax: 41.5076
## Geodetic CRS:  WGS 84
##   Site                   geometry
## 1    1  POINT (-110.809 37.84203)
## 2    2  POINT (-111.339 39.04723)
## 3    3 POINT (-109.2163 38.04543)
## 4    4 POINT (-113.1987 39.71574)
## 5    5  POINT (-111.5509 41.5076)
## 6    6 POINT (-111.5154 38.75022)</code></pre>
<p>Now when we look at the <code>head</code> of <code>sites_sf</code> it also prints out some information about this spatial object: it is a simple feature, it is a <code>POINT</code> object, the min/max coordinates (the bounding box), and the CRS. Note that the “Longitude” and “Latitude” columns turned into a “geometry” column. We can also check this information with separate functions: <code>st_bbox</code> and <code>st_crs</code></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="spatial-data-in-r.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_bbox</span>(sites_sf)</span></code></pre></div>
<pre><code>##       xmin       ymin       xmax       ymax 
## -113.50131   37.55458 -109.21630   41.50760</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="spatial-data-in-r.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(sites_sf)</span></code></pre></div>
<pre><code>## Coordinate Reference System:
##   User input: EPSG:4326 
##   wkt:
## GEOGCRS[&quot;WGS 84&quot;,
##     DATUM[&quot;World Geodetic System 1984&quot;,
##         ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
##             LENGTHUNIT[&quot;metre&quot;,1]]],
##     PRIMEM[&quot;Greenwich&quot;,0,
##         ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##     CS[ellipsoidal,2],
##         AXIS[&quot;geodetic latitude (Lat)&quot;,north,
##             ORDER[1],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##         AXIS[&quot;geodetic longitude (Lon)&quot;,east,
##             ORDER[2],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##     USAGE[
##         SCOPE[&quot;Horizontal component of 3D system.&quot;],
##         AREA[&quot;World.&quot;],
##         BBOX[-90,-180,90,180]],
##     ID[&quot;EPSG&quot;,4326]]</code></pre>
<p><code>st_crs</code> printed out a lot of information, but the important things to note are that we (the user) inputted EPSG: 4326, its datum is “World Geodetic System 1984” (or WGS 84), its axes are latitude and longitude, and its units are “degree” (as opposed to a linear unit like m that we might see in a projected crs). It’s always good practice to double check the CRS of your object before you perform any analysis.</p>
<p>Note that now when we look at the <code>class</code> of <code>sites_sf</code> it has <strong>two</strong> classes: <code>sf</code> and <code>data.frame</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="spatial-data-in-r.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sites_sf)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<p>This is one of the great things about <code>sf</code>: because <code>sf</code> objects remain as class <code>data.frame</code>, it makes it easy to work with an <code>sf</code> object like you would with any data frame.</p>
<p>Now that it’s a spatial object, let’s plot it and see what it looks like!</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="spatial-data-in-r.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sites_sf, <span class="at">pch =</span> <span class="dv">16</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotBase-1.png" width="672" /></p>
<p>This object only has one attribute (“Site”). If it had more than one, plotting in base R (i.e. using the <code>plot</code> function) plots all attributes (it will actually only plot 10 and will give you a warning if there are more than 10 attributes).</p>
<p>To just plot the feature’s shape, we can use <code>st_geometry</code> to extract the geometry of the vector</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="spatial-data-in-r.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(sites_sf), <span class="at">pch =</span> <span class="dv">16</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotBase2-1.png" width="672" /></p>
<p>We can also use <code>ggplot2</code> to plot <code>sf</code> objects. <code>ggplot2</code> has a function called <code>geom_sf</code>, which makes it easy to visualize <code>sf</code> objects with <code>ggplot2</code></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="spatial-data-in-r.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sites_sf) <span class="sc">+</span></span>
<span id="cb18-2"><a href="spatial-data-in-r.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="co"># note that we don&#39;t need to tell ggplot what it should consider x and y to be; that&#39;s already built in with the &quot;geometry&quot; column!</span></span></code></pre></div>
<p><img src="_main_files/figure-html/sfGGplot-1.png" width="672" /></p>
<p>Remember, though, that this workshop will not cover how to make nice maps in R (that will be in the next workshop). I just bring this up because you would want to be sure the data you’re working with looks like what you might expect it to, so you would want to make a quick plot before moving on to analysis.</p>
</div>
<div id="with-sp" class="section level4 unnumbered hasAnchor">
<h4>With <code>sp</code><a href="spatial-data-in-r.html#with-sp" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Let’s do the same thing but now with the <code>sp</code> package. We’ll use the function <code>coordinates</code>. This function will pull the coordinates from an object of class <code>Spatial</code>, but it will also assign coordinates to an object of class <code>data.frame</code> and automatically convert it to a <code>Spatial</code> object by following this format:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="spatial-data-in-r.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(my_dataframe) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>) <span class="co"># x &amp; y are the NAMES of the columns</span></span>
<span id="cb19-2"><a href="spatial-data-in-r.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># OR</span></span>
<span id="cb19-3"><a href="spatial-data-in-r.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(my_dataframe) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>) <span class="co"># 1 &amp; 2 are the INDICES of the columns</span></span></code></pre></div>
<p>I’m first going to make a duplicate object of “sites” called “sites_sp” because <code>coordinates</code> will overwrite the original <code>data.frame</code> object into a <code>Spatial</code> object (which is not necessarily a bad thing, but sometimes you want to keep all your objects separate in case you need to use the original data frame for some reason)</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="spatial-data-in-r.html#cb20-1" aria-hidden="true" tabindex="-1"></a>sites_sp <span class="ot">&lt;-</span> sites</span>
<span id="cb20-2"><a href="spatial-data-in-r.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(sites_sp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;Latitude&quot;</span>)</span>
<span id="cb20-3"><a href="spatial-data-in-r.html#cb20-3" aria-hidden="true" tabindex="-1"></a>sites_sp</span></code></pre></div>
<pre><code>## class       : SpatialPointsDataFrame 
## features    : 10 
## extent      : -113.5013, -109.2163, 37.55458, 41.5076  (xmin, xmax, ymin, ymax)
## crs         : NA 
## variables   : 1
## names       : Site 
## min values  :    1 
## max values  :   10</code></pre>
<p>Just like with <code>sf</code>, printing the object in <code>sp</code> will also show some information about that object, namely the class, extent, and CRS. And just like with <code>sf</code> we can use functions to look at this information for a <code>Spatial</code> object: <code>class</code>, <code>bbox</code>, and <code>proj4string</code></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="spatial-data-in-r.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sites_sp)</span></code></pre></div>
<pre><code>## [1] &quot;SpatialPointsDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="spatial-data-in-r.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bbox</span>(sites_sp)</span></code></pre></div>
<pre><code>##                  min       max
## Longitude -113.50131 -109.2163
## Latitude    37.55458   41.5076</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="spatial-data-in-r.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">proj4string</span>(sites_sp)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>The CRS right now is <code>NA</code>. With <code>sf</code> we were able to assign a CRS while also converting the data frame to a simple feature, but with <code>sp</code> we need to do that in a separate step. We’ll use <code>proj4string</code> again as this function not only checks the CRS of a spatial object but can also be used to assign a CRS. In <code>sf</code>, we could give the function the EPSG code itself, but in <code>sp</code> we need to give it a character string wrapped in the function <code>CRS</code>. There are a few ways to write this character string, but the easiest one to remember, in my opinion, follows this format: <code>"+init=epsg:####"</code> (where #### would be the EPSG code)</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="spatial-data-in-r.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">proj4string</span>(sites_sp) <span class="ot">&lt;-</span> <span class="fu">CRS</span>(<span class="st">&quot;+init=epsg:4326&quot;</span>)</span>
<span id="cb28-2"><a href="spatial-data-in-r.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">proj4string</span>(sites_sp)</span></code></pre></div>
<pre><code>## [1] &quot;+proj=longlat +datum=WGS84 +no_defs&quot;</code></pre>
<p>Great! Now let’s plot it to make sure it looks like what we would expect it to</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="spatial-data-in-r.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sites_sp, </span>
<span id="cb30-2"><a href="spatial-data-in-r.html#cb30-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>) <span class="co"># it defaults, for some reason, to a cross shape, so this changes it to a filled in circle</span></span></code></pre></div>
<p><img src="_main_files/figure-html/plotSP-1.png" width="672" /></p>
<p>It is not as straightforward to plot an object of class <code>Spatial</code> with ggplot2 as it was with <code>sf</code>, so I would recommend either converting the object to <code>sf</code> (which we will cover later in this chapter) or just plotting from the data frame</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="spatial-data-in-r.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sites) <span class="sc">+</span></span>
<span id="cb31-2"><a href="spatial-data-in-r.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude))</span></code></pre></div>
<p><img src="_main_files/figure-html/pointsGGplot-1.png" width="672" /></p>
</div>
</div>
<div id="loading-vector-data" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Loading vector data<a href="spatial-data-in-r.html#loading-vector-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A lot of the time, you will have spatial data already saved as a shapefile. How do we load that into R?</p>
<div id="with-sf-1" class="section level4 unnumbered hasAnchor">
<h4>with sf<a href="spatial-data-in-r.html#with-sf-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We’ll use the function <code>st_read</code> which takes two arguments: <code>dsn</code> (data source name), which is essentially the folder where the shapefile is located, and <code>layer</code>, which is the name of file (without any extensions). <code>layer</code> is technically optional because <code>dsn</code> will choose the first file in that folder, so if the shapefile is the only file in that folder, then <code>dsn</code> will automatically choose the file. But I like to specify the layer name to avoid any mishaps.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="spatial-data-in-r.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shapefile: freeways in Utah</span></span>
<span id="cb32-2"><a href="spatial-data-in-r.html#cb32-2" aria-hidden="true" tabindex="-1"></a>fwy_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">&quot;Data/Examples/utah_freeway&quot;</span>, <span class="at">layer =</span> <span class="st">&quot;utah_freeway&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `utah_freeway&#39; from data source 
##   `C:\Users\a02351338\Box\Ecology Center\R_Spatial_bookdown\Data\Examples\utah_freeway&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 1849 features and 7 fields
## Geometry type: LINESTRING
## Dimension:     XY
## Bounding box:  xmin: -114.0437 ymin: 37.00002 xmax: -109.0513 ymax: 42.00117
## Geodetic CRS:  WGS 84</code></pre>
<p>You’ll note that as we read in a shapefile with <code>st_read</code>, it automatically prints out the information about this feature (if you don’t want R to print this, put <code>quiet = FALSE</code> in the function).</p>
<p>Again, we can check this information separately (in case we forget or we need to check later in the analysis). We can also check the first few rows of the data frame to see what kind of attributes there are, and we can plot the feature to make sure it looks like what we expect it to be.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="spatial-data-in-r.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_bbox</span>(fwy_sf)</span></code></pre></div>
<pre><code>##       xmin       ymin       xmax       ymax 
## -114.04367   37.00002 -109.05128   42.00117</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="spatial-data-in-r.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(fwy_sf)</span></code></pre></div>
<pre><code>## Coordinate Reference System:
##   User input: WGS 84 
##   wkt:
## GEOGCRS[&quot;WGS 84&quot;,
##     DATUM[&quot;World Geodetic System 1984&quot;,
##         ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
##             LENGTHUNIT[&quot;metre&quot;,1]]],
##     PRIMEM[&quot;Greenwich&quot;,0,
##         ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##     CS[ellipsoidal,2],
##         AXIS[&quot;latitude&quot;,north,
##             ORDER[1],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##         AXIS[&quot;longitude&quot;,east,
##             ORDER[2],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##     ID[&quot;EPSG&quot;,4326]]</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="spatial-data-in-r.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fwy_sf)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 7 fields
## Geometry type: LINESTRING
## Dimension:     XY
## Bounding box:  xmin: -112.0148 ymin: 40.12468 xmax: -111.6544 ymax: 41.24017
## Geodetic CRS:  WGS 84
##   OBJECTID    FULLNAME    NAME POSTTYPE SPEED_LMT                  UNIQUE_ID
## 1      898 I-80 EB FWY I-80 EB      FWY        65  12TVL21421309_I-80 EB_FWY
## 2     1372 I-15 NB FWY I-15 NB      FWY        65  12TVK44214181_I-15 NB_FWY
## 3     1374 I-84 WB FWY I-84 WB      FWY        70 12TVL528848324_I-84 WB_FWY
## 4     1727 I-15 NB FWY I-15 NB      FWY        70  12TVL14996575_I-15 NB_FWY
## 5     1955 I-84 WB FWY I-84 WB      FWY        65  12TVL43954376_I-84 WB_FWY
## 6     2062 I-15 NB FWY I-15 NB      FWY        65  12TVL22992231_I-15 NB_FWY
##   Shape__Len                       geometry
## 1  331.34350 LINESTRING (-111.9295 40.76...
## 2   87.78441 LINESTRING (-111.6551 40.12...
## 3 1030.55015 LINESTRING (-111.9096 41.13...
## 4  442.62095 LINESTRING (-112.0148 41.24...
## 5  423.15540 LINESTRING (-111.6685 41.04...
## 6  489.79063 LINESTRING (-111.9144 40.84...</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="spatial-data-in-r.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fwy_sf) <span class="sc">+</span></span>
<span id="cb40-2"><a href="spatial-data-in-r.html#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/checkSF2-1.png" width="672" /></p>
</div>
<div id="with-sp-1" class="section level4 unnumbered hasAnchor">
<h4>with sp<a href="spatial-data-in-r.html#with-sp-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To read in spatial data as an object in the <code>Spatial</code> family, we need to use the <code>rgdal</code> package. (When you load in <code>rgdal</code>, it will also automatically load in <code>sp</code>). We’ll use the <code>rgdal</code> function <code>readOGR</code>. This function is similar to <code>st_read</code> in that its arguments are <code>dsn</code> and <code>layer</code> which work exactly the same way as they do in <code>st_read</code></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="spatial-data-in-r.html#cb41-1" aria-hidden="true" tabindex="-1"></a>fwy_sp <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(<span class="at">dsn =</span> <span class="st">&quot;Data/Examples/utah_freeway&quot;</span>, <span class="at">layer =</span> <span class="st">&quot;utah_freeway&quot;</span>)</span></code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;C:\Users\a02351338\Box\Ecology Center\R_Spatial_bookdown\Data\Examples\utah_freeway&quot;, layer: &quot;utah_freeway&quot;
## with 1849 features
## It has 7 fields</code></pre>
<p><code>read_OGR</code>, also like <code>st_read</code>, will print out some information after reading in the shapefile. If you want to turn this off, you can add <code>verbose = FALSE</code> in the function’s arguments.</p>
<p>Let’s check the feature’s information (class, extent, and CRS) and plot it</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="spatial-data-in-r.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(fwy_sp)</span></code></pre></div>
<pre><code>## [1] &quot;SpatialLinesDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="spatial-data-in-r.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bbox</span>(fwy_sp)</span></code></pre></div>
<pre><code>##          min        max
## x -114.04367 -109.05128
## y   37.00002   42.00117</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="spatial-data-in-r.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">proj4string</span>(fwy_sp)</span></code></pre></div>
<pre><code>## [1] &quot;+proj=longlat +datum=WGS84 +no_defs&quot;</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="spatial-data-in-r.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fwy_sp)</span></code></pre></div>
<p><img src="_main_files/figure-html/checkSP2-1.png" width="672" /></p>
</div>
</div>
<div id="projecting-vector-data" class="section level3 hasAnchor" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Projecting vector data<a href="spatial-data-in-r.html#projecting-vector-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>So far all of our vector data has only been in WGS 84 lat/long CRS. More than likely you will want to work in a projected coordinate system. So how do we re-project (or transform) features in R?</p>
<ul>
<li>In <code>sf</code> we’ll use the function <code>st_transform()</code></li>
<li>In <code>sp</code> we’ll use the function <code>spTransform()</code></li>
</ul>
<p>Both of these functions need the object you want to re-project and the target CRS.</p>
<p>What CRS should we work in? Like I said earlier, UTM is a popular projection because it’s localized and allows you to work with with linear metrics like length, area, and distance. Since both of these features (our site data and Utah freeways) are located in Utah, we would use UTM 12N. We can stay in the WGS 84 datum, but for the purposes of demonstration, let’s change to NAD83. (Remember from the previous chapter that there is not much difference between these datums, so it’s up to you if you want to use a more localized datum (NAD83) or a more recent datum (WGS84)). The EPSG code for NAD83 UTM 12N is <a href="https://www.spatialreference.org/ref/epsg/26912/">26912</a>. (If you want to work in WGS84 UTM 12N, the EPSG code is <a href="https://www.spatialreference.org/ref/epsg/32612/">32612</a>)</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="spatial-data-in-r.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sf</span></span>
<span id="cb50-2"><a href="spatial-data-in-r.html#cb50-2" aria-hidden="true" tabindex="-1"></a>fwy_sf_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(fwy_sf, <span class="at">crs =</span> <span class="dv">26912</span>)</span>
<span id="cb50-3"><a href="spatial-data-in-r.html#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(fwy_sf_proj)</span></code></pre></div>
<pre><code>## Coordinate Reference System:
##   User input: EPSG:26912 
##   wkt:
## PROJCRS[&quot;NAD83 / UTM zone 12N&quot;,
##     BASEGEOGCRS[&quot;NAD83&quot;,
##         DATUM[&quot;North American Datum 1983&quot;,
##             ELLIPSOID[&quot;GRS 1980&quot;,6378137,298.257222101,
##                 LENGTHUNIT[&quot;metre&quot;,1]]],
##         PRIMEM[&quot;Greenwich&quot;,0,
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##         ID[&quot;EPSG&quot;,4269]],
##     CONVERSION[&quot;UTM zone 12N&quot;,
##         METHOD[&quot;Transverse Mercator&quot;,
##             ID[&quot;EPSG&quot;,9807]],
##         PARAMETER[&quot;Latitude of natural origin&quot;,0,
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
##             ID[&quot;EPSG&quot;,8801]],
##         PARAMETER[&quot;Longitude of natural origin&quot;,-111,
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
##             ID[&quot;EPSG&quot;,8802]],
##         PARAMETER[&quot;Scale factor at natural origin&quot;,0.9996,
##             SCALEUNIT[&quot;unity&quot;,1],
##             ID[&quot;EPSG&quot;,8805]],
##         PARAMETER[&quot;False easting&quot;,500000,
##             LENGTHUNIT[&quot;metre&quot;,1],
##             ID[&quot;EPSG&quot;,8806]],
##         PARAMETER[&quot;False northing&quot;,0,
##             LENGTHUNIT[&quot;metre&quot;,1],
##             ID[&quot;EPSG&quot;,8807]]],
##     CS[Cartesian,2],
##         AXIS[&quot;(E)&quot;,east,
##             ORDER[1],
##             LENGTHUNIT[&quot;metre&quot;,1]],
##         AXIS[&quot;(N)&quot;,north,
##             ORDER[2],
##             LENGTHUNIT[&quot;metre&quot;,1]],
##     USAGE[
##         SCOPE[&quot;Engineering survey, topographic mapping.&quot;],
##         AREA[&quot;North America - between 114Â°W and 108Â°W - onshore and offshore. Canada - Alberta; Northwest Territories; Nunavut; Saskatchewan.  United States (USA) - Arizona; Colorado; Idaho; Montana; New Mexico; Utah; Wyoming.&quot;],
##         BBOX[31.33,-114,84,-108]],
##     ID[&quot;EPSG&quot;,26912]]</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="spatial-data-in-r.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sp</span></span>
<span id="cb52-2"><a href="spatial-data-in-r.html#cb52-2" aria-hidden="true" tabindex="-1"></a>sites_sp_proj <span class="ot">&lt;-</span> <span class="fu">spTransform</span>(sites_sp, <span class="st">&quot;+init=epsg:26912&quot;</span>)</span>
<span id="cb52-3"><a href="spatial-data-in-r.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">proj4string</span>(sites_sp_proj)</span></code></pre></div>
<pre><code>## [1] &quot;+proj=utm +zone=12 +datum=NAD83 +units=m +no_defs&quot;</code></pre>
<p>Note that the coordinates of the WGS84 object compared the coordinates of the projected object are different.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="spatial-data-in-r.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(fwy_sf)</span></code></pre></div>
<pre><code>## Geometry set for 1849 features 
## Geometry type: LINESTRING
## Dimension:     XY
## Bounding box:  xmin: -114.0437 ymin: 37.00002 xmax: -109.0513 ymax: 42.00117
## Geodetic CRS:  WGS 84
## First 5 geometries:</code></pre>
<pre><code>## LINESTRING (-111.9295 40.76479, -111.9324 40.76...</code></pre>
<pre><code>## LINESTRING (-111.6551 40.12468, -111.6547 40.12...</code></pre>
<pre><code>## LINESTRING (-111.9096 41.13769, -111.9089 41.13...</code></pre>
<pre><code>## LINESTRING (-112.0148 41.24017, -112.0145 41.23...</code></pre>
<pre><code>## LINESTRING (-111.6685 41.04395, -111.6653 41.0424)</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="spatial-data-in-r.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(fwy_sf_proj)</span></code></pre></div>
<pre><code>## Geometry set for 1849 features 
## Geometry type: LINESTRING
## Dimension:     XY
## Bounding box:  xmin: 242993.7 ymin: 4098090 xmax: 668288.9 ymax: 4651339
## Projected CRS: NAD83 / UTM zone 12N
## First 5 geometries:</code></pre>
<pre><code>## LINESTRING (421549.3 4513062, 421304.4 4513119)</code></pre>
<pre><code>## LINESTRING (444185.1 4441802, 444220.4 4441825,...</code></pre>
<pre><code>## LINESTRING (423663.9 4554441, 423720.3 4554432,...</code></pre>
<pre><code>## LINESTRING (414965.3 4565915, 414986 4565753, 4...</code></pre>
<pre><code>## LINESTRING (443817.3 4543851, 444084.9 4543677)</code></pre>
<p>The coordinates for the object in WGS84 are in lat/long and the units are decimal degrees. The coordiantes for the projected object are in UTM and the untis are meters.</p>
<p><strong>REMINDER:</strong> You should <strong>always</strong> double-check the CRS of every feature and object you’re working with because you want to make sure everything is projected to the <strong>same</strong> CRS! If they’re not, it could result in inaccurate analysis and plotting. Depending on what functions you’re using, R may give you a warning or error that the CRS of one feature and another don’t match, but it’s best not to rely on this and just double-check yourself.</p>
</div>
<div id="saving-vector-data" class="section level3 hasAnchor" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> Saving vector data<a href="spatial-data-in-r.html#saving-vector-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once you’ve created or modified a spatial object, most likely you want to save it so you can use it later or share with collaborators. There are many files types that can hold spatial data, but the most commonly used are ESRI Shapefile (which can be used in ArcGIS software), KML (which can be used with Google Earth Engine), GeoJSON, and PostgreSQL. If you’re curious what other file types are out there, you can use functions <code>st_drivers()</code> or <code>ogrDrivers()</code> for <code>sf</code> and <code>sp</code> respectively. In this workshop, I will focus just on ESRI Shapefiles.</p>
<p>If you’ve worked with shapefiles before, you’ve likely noticed that a shapefile is actually a collection of files with the extensions .dbf, .prj, .shp, and .shx. It’s often easier to organize and share shapefiles if they’re in their own folder. If you don’t already have a folder ready for any shapefiles that you’re ready to save, you can, of course, manually make one in the File Explorer. But you can also create folders in R! I, personally, often like to do this because it helps streamline my process. To do so we’ll use the functions <code>dir.exists()</code> to check if the directory (or folder) or not, and if it doesn’t we’ll use <code>dir.create()</code> to create a directory.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="spatial-data-in-r.html#cb68-1" aria-hidden="true" tabindex="-1"></a>out_dir <span class="ot">&lt;-</span> <span class="st">&quot;Data/Examples/Sites_shp&quot;</span> <span class="co"># name what you want the folder to be and save it in an object</span></span>
<span id="cb68-2"><a href="spatial-data-in-r.html#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="spatial-data-in-r.html#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(out_dir)){ <span class="co"># this if statement is basically saying &quot;if out_dir does NOT exist...&quot; (the NOT is from the exclamation mark)</span></span>
<span id="cb68-4"><a href="spatial-data-in-r.html#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(out_dir) <span class="co"># and if out_dir does NOT exist, then dir.create will create it</span></span>
<span id="cb68-5"><a href="spatial-data-in-r.html#cb68-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now that we’ve created a new directory for this shapefile to go to, let’s save our shapefile! For <code>sf</code> objects we’ll use the function <code>st_write</code> and for <code>Spatial*</code> objects we’ll use the function <code>writeOGR</code>. The arguments for these two functions are basically the same: they take the object you’re saving, the dsn (or the folder) you want to save it to, the layer (or the name you want to save the file as, do NOT add an extension), and the driver (meaning if you’re saving it as an ESRI Shapefile, KML, etc.)</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="spatial-data-in-r.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sf</span></span>
<span id="cb69-2"><a href="spatial-data-in-r.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(sites_sf, <span class="at">dsn =</span> out_dir, <span class="at">layer =</span> <span class="st">&quot;Sites_sf&quot;</span>, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>)</span>
<span id="cb69-3"><a href="spatial-data-in-r.html#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="spatial-data-in-r.html#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sp</span></span>
<span id="cb69-5"><a href="spatial-data-in-r.html#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="fu">writeOGR</span>(sites_sp, <span class="at">dsn =</span> out_dir, <span class="at">layer =</span> <span class="st">&quot;Sites_sp&quot;</span>, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>)</span></code></pre></div>
<p>In reality I would only be working with either an <code>sf</code> object or a <code>Spatial*</code> object and I wouldn’t save both (because once they’re saved as a shapefile, they are exactly the same file).</p>
</div>
<div id="converting-between-sf-and-sp" class="section level3 hasAnchor" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> Converting between <code>sf</code> and <code>sp</code><a href="spatial-data-in-r.html#converting-between-sf-and-sp" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As I mentioned before, there is no reason to not use both <code>sf</code> and <code>Spatial*</code> objects in one piece of code, but it doesn’t make sense to load or create a single object as both an <code>sf</code> and <code>Spatial*</code> class. In some cases it makes more sense to work with <code>sf</code> objects and then convert them to <code>Spatial*</code> if needed (or vice versa). Lucky for us, it’s pretty easy to convert an <code>sf</code> object to <code>Spatial*</code> and then back to <code>sf</code>. For <code>sf</code> -&gt; <code>Spatial*</code> we’ll use the function <code>as()</code> or <code>as_Spatial()</code>. For <code>Spatial*</code> -&gt; <code>sf</code> we’ll use a function we’ve allready used: <code>st_as_sf()</code></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="spatial-data-in-r.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert sf object to Spatial</span></span>
<span id="cb70-2"><a href="spatial-data-in-r.html#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(fwy_sf)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="spatial-data-in-r.html#cb72-1" aria-hidden="true" tabindex="-1"></a>fwy_sf_to_sp <span class="ot">&lt;-</span> <span class="fu">as_Spatial</span>(fwy_sf)</span>
<span id="cb72-2"><a href="spatial-data-in-r.html#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(fwy_sf_to_sp)</span></code></pre></div>
<pre><code>## [1] &quot;SpatialLinesDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="spatial-data-in-r.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># you can also use the function as() and add an argument &quot;Spatial&quot;</span></span>
<span id="cb74-2"><a href="spatial-data-in-r.html#cb74-2" aria-hidden="true" tabindex="-1"></a>fwy_sf_to_sp_2 <span class="ot">&lt;-</span> <span class="fu">as</span>(fwy_sf, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb74-3"><a href="spatial-data-in-r.html#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(fwy_sf_to_sp, fwy_sf_to_sp_2) <span class="co"># they are exactly the same</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="spatial-data-in-r.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert Spatial object to sf</span></span>
<span id="cb76-2"><a href="spatial-data-in-r.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(fwy_sp)</span></code></pre></div>
<pre><code>## [1] &quot;SpatialLinesDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="spatial-data-in-r.html#cb78-1" aria-hidden="true" tabindex="-1"></a>fwy_sp_to_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(fwy_sp)</span>
<span id="cb78-2"><a href="spatial-data-in-r.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(fwy_sp_to_sf)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
</div>
<div id="a-note-about-sf-and-tidyverse" class="section level3 unnumbered hasAnchor">
<h3>A note about <code>sf</code> and <code>tidyverse</code><a href="spatial-data-in-r.html#a-note-about-sf-and-tidyverse" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As I mentioned earlier, <code>sf</code> works really well with <code>tidyverse</code>. If you are familiar with <code>tidyverse</code> then you know that one pro is the pipe (<code>%&gt;%</code>) which lets you perform multiple functions at once without getting cluttered and hard to read. Functions for <code>sf</code> can easily be incorporated into the <code>tidyverse</code> piping method as well. For an example, we can load a csv file, covert it to an <code>sf</code> object, project it, and save it all at once using the pipes.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="spatial-data-in-r.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read.csv</span>(<span class="st">&quot;Data/Examples/Sites.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="spatial-data-in-r.html#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;Latitude&quot;</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="spatial-data-in-r.html#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">26912</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-4"><a href="spatial-data-in-r.html#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_write</span>(<span class="at">dsn =</span> <span class="st">&quot;data&quot;</span>, <span class="at">layer =</span> <span class="st">&quot;Sites_shp&quot;</span>, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>)</span></code></pre></div>
<p>Of course, this requires that you already know what the column names for the coordinates are, and this might not be the best example for a series of functions to use with the pipe. But this type of process is a useful tool to know, especially if you are already familiar with and frequently use <code>tidyverse</code>.</p>
</div>
<div id="your-turn" class="section level3 unnumbered hasAnchor">
<h3>Your Turn!<a href="spatial-data-in-r.html#your-turn" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the attached “worksheet”, there are some exerices to help you practice these concepts and functions. Try them out!</p>
<hr />
</div>
</div>
<div id="rasters-1" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Rasters<a href="spatial-data-in-r.html#rasters-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The primary package that deals with rasters is <a href="https://cran.r-project.org/web/packages/raster/index.html"><code>raster</code></a>. Note that <code>raster</code> depends on the <code>sp</code> package, as it loads <code>sp</code> automatically when you load <code>raster</code>. (<a href="https://cran.r-project.org/web/packages/terra/index.html"><code>terra</code></a> also works with rasters but is funcitonally very similar to <code>raster</code>).</p>
<div id="load-a-raster" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Load a raster<a href="spatial-data-in-r.html#load-a-raster" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When you want to load a raster that is saved in a directory, you’ll use the (aptly named) function <code>raster</code>. When loading a raster that is already saved, the only argument you need is the filename (including the directory and extension)</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="spatial-data-in-r.html#cb81-1" aria-hidden="true" tabindex="-1"></a>elev <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">&quot;Data/Examples/elevation.tif&quot;</span>)</span>
<span id="cb81-2"><a href="spatial-data-in-r.html#cb81-2" aria-hidden="true" tabindex="-1"></a>elev</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 334, 390, 130260  (nrow, ncol, ncell)
## resolution : 0.000278, 0.000278  (x, y)
## extent     : -114.0275, -113.9191, 36.40381, 36.49667  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : elevation.tif 
## names      : elevation 
## values     : 645.7881, 1137.67  (min, max)</code></pre>
<p>When we examine the raster (by simply calling the object like we did above), we get a lot of useful information.</p>
<ul>
<li><code>class</code>: the class of the raster (this could be <code>RasterLayer</code>, <code>RasterStack</code>, or <code>RasterBrick</code>)</li>
<li><code>dimensions</code>: the number of rows, columns, and cells</li>
<li><code>resolution</code>: the size of the cells</li>
<li><code>extent</code>: the min/max x and y</li>
<li><code>crs</code>: the coordinate reference system</li>
<li><code>values</code>: the min/max values this raster contains</li>
</ul>
<p>I recommend <em>always</em> examining a raster after you load it in to make sure the information looks like what you would expect it to be.</p>
<p>You can also check all of this information with separate functions:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="spatial-data-in-r.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(elev)</span></code></pre></div>
<pre><code>## [1] &quot;RasterLayer&quot;
## attr(,&quot;package&quot;)
## [1] &quot;raster&quot;</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="spatial-data-in-r.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(elev)</span></code></pre></div>
<pre><code>## [1] 334</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="spatial-data-in-r.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(elev)</span></code></pre></div>
<pre><code>## [1] 390</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="spatial-data-in-r.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncell</span>(elev)</span></code></pre></div>
<pre><code>## [1] 130260</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="spatial-data-in-r.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">res</span>(elev) <span class="co"># the cell resolution of the raster</span></span></code></pre></div>
<pre><code>## [1] 0.000278 0.000278</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="spatial-data-in-r.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extent</span>(elev)</span></code></pre></div>
<pre><code>## class      : Extent 
## xmin       : -114.0275 
## xmax       : -113.9191 
## ymin       : 36.40381 
## ymax       : 36.49667</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="spatial-data-in-r.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">proj4string</span>(elev) <span class="co"># alternatively, we can use crs(r) which will print out a lot more information. proj4string() is sufficient</span></span></code></pre></div>
<pre><code>## [1] &quot;+proj=longlat +datum=WGS84 +no_defs&quot;</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="spatial-data-in-r.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">values</span>(elev)) <span class="co"># put this in summary() so we can get an idea of the spread of values (rather than a list of all of the values themselves)</span></span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   645.8   798.5   869.5   864.4   932.0  1137.7</code></pre>
<p>We can also plot the raster to check that it looks like what we would expect it to be</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="spatial-data-in-r.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(elev)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotRast-1.png" width="672" /></p>
<p>We can also plot a raster with <code>ggplot2</code>, but we need to do an extra step of converting it to a data frame first. We’ll use the base R function <code>as.data.frame</code> and we need to be sure to put <code>xy = TRUE</code> in the arguments. After we do that, we can use the function <code>geom_raster()</code> within <code>ggplot</code>. Within the <code>aes()</code> function in <code>geom_raster()</code>, we need to put the columns that correspond to the x and y locations and what the fill value should represent (in this case, elevation).</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="spatial-data-in-r.html#cb100-1" aria-hidden="true" tabindex="-1"></a>elev_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(elev, <span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb100-2"><a href="spatial-data-in-r.html#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(elev_df) <span class="co"># the data frame of a raster contains columns for the x and y locations and the corresponding cell value</span></span></code></pre></div>
<pre><code>##           x        y elevation
## 1 -114.0274 36.49653  1082.456
## 2 -114.0271 36.49653  1081.739
## 3 -114.0268 36.49653  1080.975
## 4 -114.0265 36.49653  1079.712
## 5 -114.0262 36.49653  1077.750
## 6 -114.0260 36.49653  1075.466</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="spatial-data-in-r.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(elev_df) <span class="sc">+</span></span>
<span id="cb102-2"><a href="spatial-data-in-r.html#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> elevation))</span></code></pre></div>
<p><img src="_main_files/figure-html/plotRastGGplot-1.png" width="672" /></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="spatial-data-in-r.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You can use the pipe to run this process all at once</span></span>
<span id="cb103-2"><a href="spatial-data-in-r.html#cb103-2" aria-hidden="true" tabindex="-1"></a>elev <span class="sc">%&gt;%</span></span>
<span id="cb103-3"><a href="spatial-data-in-r.html#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="at">xy =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb103-4"><a href="spatial-data-in-r.html#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb103-5"><a href="spatial-data-in-r.html#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> elevation)) <span class="co"># This requires that you know the column name of the raster values</span></span></code></pre></div>
<p>An important thing to note is that, depending on the size of the raster, it might be too computationally expensive to convert a raster to a data frame and R may give you an error.</p>
<p>(Another reminder that we will not cover how to make these maps look nice, this is just a quick way to check that your raster looks the way that you think it should)</p>
<div id="loading-a-raster-with-more-than-one-band" class="section level4 unnumbered hasAnchor">
<h4>Loading a raster with more than one band<a href="spatial-data-in-r.html#loading-a-raster-with-more-than-one-band" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In the example above, the raster we loaded only had one band. Let’s try loading in a raster downloaded from <a href="https://nsidc.org/data/g02158">SNODAS</a> (Snow Data Assimilation System) which has 2 bands: SWE (snow water equivalent) and snow depth. (SNODAS offers daily rasters, and this example raster is from 02-23-2019).</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="spatial-data-in-r.html#cb104-1" aria-hidden="true" tabindex="-1"></a>snow <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">&quot;Data/Examples/snow_20190223.tif&quot;</span>)</span>
<span id="cb104-2"><a href="spatial-data-in-r.html#cb104-2" aria-hidden="true" tabindex="-1"></a>snow</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## band       : 1  (of  2  bands)
## dimensions : 12, 13, 156  (nrow, ncol, ncell)
## resolution : 0.008333333, 0.008333333  (x, y)
## extent     : -114.025, -113.9167, 36.4, 36.5  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : snow_20190223.tif 
## names      : snow_20190223 
## values     : 0, 24  (min, max)</code></pre>
<p>Notice how it says band 1 (of 2). If there are two bands, why did it only load 1? If we look in the help file for <code>?raster</code>, it says that this function creates a <code>RasterLayer</code> object, meaning only <strong>1</strong> band. We can also see that there’s an argument called <code>band</code>, meaning you can specify which band you want to load (and the default is the first band). We <em>could</em> load individual bands one-by-one, but that’s tedious and, depending how many bands a raster stack has, could be lines and lines of repetitive code.</p>
<p>Instead, we’ll use the function <code>stack()</code> or <code>brick()</code></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="spatial-data-in-r.html#cb106-1" aria-hidden="true" tabindex="-1"></a>snow_stack <span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="st">&quot;Data/Examples/snow_20190223.tif&quot;</span>)</span>
<span id="cb106-2"><a href="spatial-data-in-r.html#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(snow_stack)</span></code></pre></div>
<pre><code>## [1] &quot;RasterStack&quot;
## attr(,&quot;package&quot;)
## [1] &quot;raster&quot;</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="spatial-data-in-r.html#cb108-1" aria-hidden="true" tabindex="-1"></a>snow_stack</span></code></pre></div>
<pre><code>## class      : RasterStack 
## dimensions : 12, 13, 156, 2  (nrow, ncol, ncell, nlayers)
## resolution : 0.008333333, 0.008333333  (x, y)
## extent     : -114.025, -113.9167, 36.4, 36.5  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## names      : snow_20190223.1, snow_20190223.2 
## min values :               0,               0 
## max values :              24,             150</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="spatial-data-in-r.html#cb110-1" aria-hidden="true" tabindex="-1"></a>snow_brick <span class="ot">&lt;-</span> <span class="fu">brick</span>(<span class="st">&quot;Data/Examples/snow_20190223.tif&quot;</span>)</span>
<span id="cb110-2"><a href="spatial-data-in-r.html#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(snow_brick)</span></code></pre></div>
<pre><code>## [1] &quot;RasterBrick&quot;
## attr(,&quot;package&quot;)
## [1] &quot;raster&quot;</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="spatial-data-in-r.html#cb112-1" aria-hidden="true" tabindex="-1"></a>snow_brick</span></code></pre></div>
<pre><code>## class      : RasterBrick 
## dimensions : 12, 13, 156, 2  (nrow, ncol, ncell, nlayers)
## resolution : 0.008333333, 0.008333333  (x, y)
## extent     : -114.025, -113.9167, 36.4, 36.5  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : snow_20190223.tif 
## names      : snow_20190223.1, snow_20190223.2 
## min values :               0,               0 
## max values :              24,             150</code></pre>
<p>When we call the stack and the brick, they look identical besides the class. So what are the differences between a stack and brick? When we look at <code>?brick</code>, the help file tells us a few differences. Both a <code>RasterStack</code> and <code>RasterBrick</code> are multi-layer raster objects, but processing time is shorter with a <code>RasterBrick</code>. However. a <code>RasterBrick</code> is less flexible than a <code>RasterStack</code> because it can only be created from a <strong>single</strong> file, while a <code>RasterStack</code> could be fed a list of file names or raster objects and automatically stack them all together. For the purposes of this example, a stack and a brick are essentially identical.</p>
<p>Let’s plot the raster stack just to make sure it looks like what we might expect:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="spatial-data-in-r.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(snow_stack)</span></code></pre></div>
<p><img src="_main_files/figure-html/plotStk-1.png" width="672" /></p>
<p>Note that plotting a raster stack (or brick) will plot all the layers at once.</p>
<p>The benefit of working with a stack of rasters is that if you need to perform a computation on all of your rasters, you can stack them all togther and the computation will run for every raster layer in the stack. <strong>However</strong>, rasters will only stack together if they have the same <strong>dimensions</strong>, <strong>resolution</strong>, <strong>extent</strong>, and <strong>crs</strong>.</p>
<p>For example, if we try to stack our elevation raster and stack of snow rasters together:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="spatial-data-in-r.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stack</span>(elev, snow_stack)</span></code></pre></div>
<p><code>Error in compareRaster(x) : different extent</code></p>
<p>We get an error that the extents don’t match</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="spatial-data-in-r.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extent</span>(elev)</span></code></pre></div>
<pre><code>## class      : Extent 
## xmin       : -114.0275 
## xmax       : -113.9191 
## ymin       : 36.40381 
## ymax       : 36.49667</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="spatial-data-in-r.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extent</span>(snow_stack)</span></code></pre></div>
<pre><code>## class      : Extent 
## xmin       : -114.025 
## xmax       : -113.9167 
## ymin       : 36.4 
## ymax       : 36.5</code></pre>
<p>They’re very close, but they need to be <em>exact</em>. <strong>Why can’t I just not stack them and run seperate computations on these rasters?</strong> You can, but your raster cells will be slightly off from each other and may result in inaccurate results and inference.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:stack2"></span>
<img src="pictures/raster_stack.png" alt="A stack of rasters, showing how each cell would correspond to the ones on top and below" width="50%" />
<p class="caption">
Figure 3.1: A stack of rasters, showing how each cell would correspond to the ones on top and below
</p>
</div>
<p>In a future section, we’ll talk about how to make your rasters line up so you can stack them all together.</p>
</div>
</div>
<div id="create-a-raster" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Create a raster<a href="spatial-data-in-r.html#create-a-raster" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To create a raster from scratch, we’ll use the same function <code>raster()</code> but instead of the filename or band as arguments, we’ll include the extent and resolution that we want. In this example, let’s just make something random.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="spatial-data-in-r.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>) <span class="co"># this is to make the randomness of runif the same every time </span></span>
<span id="cb120-2"><a href="spatial-data-in-r.html#cb120-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">10</span>)</span>
<span id="cb120-3"><a href="spatial-data-in-r.html#cb120-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">10</span>)</span>
<span id="cb120-4"><a href="spatial-data-in-r.html#cb120-4" aria-hidden="true" tabindex="-1"></a>r_new <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="at">xmn =</span> x, <span class="at">xmx =</span> x <span class="sc">+</span> <span class="dv">10</span>, <span class="at">ymn =</span> y, <span class="at">ymx =</span> y <span class="sc">+</span> <span class="dv">10</span>, <span class="at">resolution =</span> <span class="dv">1</span>)</span>
<span id="cb120-5"><a href="spatial-data-in-r.html#cb120-5" aria-hidden="true" tabindex="-1"></a>r_new</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 10, 10, 100  (nrow, ncol, ncell)
## resolution : 1, 1  (x, y)
## extent     : 2.655087, 12.65509, 3.721239, 13.72124  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs</code></pre>
<p>Note that because we didn’t specify the CRS in the arguments, it defaulted to WGS84 lat/long.</p>
<p>Right now this raster is empty. We can check with the function <code>values()</code></p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="spatial-data-in-r.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">values</span>(r_new))</span></code></pre></div>
<pre><code>## [1] NA NA NA NA NA NA</code></pre>
<p>We’ll use the same function to assign fill the raster with values. If you noticed, there are 100 total cells that need to be filled, and let’s fill them with random numbers.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="spatial-data-in-r.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(r_new) <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">100</span>)</span>
<span id="cb124-2"><a href="spatial-data-in-r.html#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">values</span>(r_new))</span></code></pre></div>
<pre><code>## [1] 0.5728534 0.9082078 0.2016819 0.8983897 0.9446753 0.6607978</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="spatial-data-in-r.html#cb126-1" aria-hidden="true" tabindex="-1"></a>r_new</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 10, 10, 100  (nrow, ncol, ncell)
## resolution : 1, 1  (x, y)
## extent     : 2.655087, 12.65509, 3.721239, 13.72124  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : memory
## names      : layer 
## values     : 0.01339033, 0.9919061  (min, max)</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="spatial-data-in-r.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(r_new)</span></code></pre></div>
<p><img src="_main_files/figure-html/addVals-1.png" width="672" /></p>
<p><strong>Why would you need to create a raster from scratch?</strong></p>
<ol style="list-style-type: decimal">
<li>If you’ve written code to perform a calculation or an analysis on a raster, it’s good to check that your code is doing what you think it’s doing. A good way to test the code is to try it out on a “dummy” raster</li>
<li>If you’re asking for help on your code (on <a href="https://stackoverflow.com/">Stack Overflow</a> for example), it’s good practice to either include your data (which is often very difficult to do) or to create a reproducible example. Knowing how to create fake data or fake rasters is useful to know.</li>
<li>We’ll see in the next section another useful reason for creating a raster from scratch.</li>
</ol>
</div>
<div id="project-a-raster" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Project a raster<a href="spatial-data-in-r.html#project-a-raster" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s go back to the elevation raster we loaded earlier. If you noticed, the CRS of this raster is WGS84 UTM12N, as opposed to NAD83 UTM12N that we used earlier for our vector data.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="spatial-data-in-r.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">proj4string</span>(elev)</span></code></pre></div>
<pre><code>## [1] &quot;+proj=longlat +datum=WGS84 +no_defs&quot;</code></pre>
<p>If we were going to do some sort of analysis on our vector data and raster data, we want all of our spatial objects to be in the same CRS so that we know that our layers are <em>truly</em> stacked on top of the other (for plotting and analysis). For that reason, we need to project this raster to NAD83 UTM12N. To do so, we’ll use the function <code>projectRaster</code></p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="spatial-data-in-r.html#cb131-1" aria-hidden="true" tabindex="-1"></a>elev_proj <span class="ot">&lt;-</span> <span class="fu">projectRaster</span>(elev, <span class="at">crs =</span> <span class="st">&quot;+init=epsg:26912&quot;</span>)</span>
<span id="cb131-2"><a href="spatial-data-in-r.html#cb131-2" aria-hidden="true" tabindex="-1"></a>elev_proj</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 354, 415, 146910  (nrow, ncol, ncell)
## resolution : 24.9, 30.8  (x, y)
## extent     : 228349.4, 238682.9, 4032553, 4043456  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=NAD83 +units=m +no_defs 
## source     : memory
## names      : elevation 
## values     : 645.8186, 1136.32  (min, max)</code></pre>
<p>Wait, let’s take a look at the cell resolution again…</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="spatial-data-in-r.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">res</span>(elev_proj)</span></code></pre></div>
<pre><code>## [1] 24.9 30.8</code></pre>
<p>This elevation raster came from the <a href="https://www.usgs.gov/3d-elevation-program">USGS’s 3D Elevation Program</a>. When I downloaded it, I specified a 1-arcsecond resolution (arcsecond is the unit for long/lat projections), which is equivalent to a 30mX30m resolution in a linear projection (like UTM). So why is the resolution after projecting not actually 30mX30m?</p>
<p>What’s happening is that <em>every</em> cell needs to be projected, causing the cells to be warped and results in slightly off cell measurements.</p>
<p>What if we tried specifying the cell resolution in the <code>projectRaster</code> function?</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="spatial-data-in-r.html#cb135-1" aria-hidden="true" tabindex="-1"></a>elev_proj_2 <span class="ot">&lt;-</span> <span class="fu">projectRaster</span>(elev, <span class="at">crs =</span> <span class="st">&quot;+init=epsg:26912&quot;</span>, <span class="at">res =</span> <span class="dv">30</span>)</span>
<span id="cb135-2"><a href="spatial-data-in-r.html#cb135-2" aria-hidden="true" tabindex="-1"></a>elev_proj_2</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 363, 345, 125235  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 228348.8, 238698.8, 4032562, 4043452  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=NAD83 +units=m +no_defs 
## source     : memory
## names      : elevation 
## values     : 645.8673, 1137.32  (min, max)</code></pre>
<p>We could do this. But can we be sure that all of the cells in this raster would align one-to-one in all of our other rasters? And if they don’t align, can we be sure our analysis and computation on all of our rasters would be correct?</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="spatial-data-in-r.html#cb137-1" aria-hidden="true" tabindex="-1"></a>snow_proj <span class="ot">&lt;-</span> <span class="fu">projectRaster</span>(snow_stack, <span class="at">crs =</span> <span class="st">&quot;+init=epsg:26912&quot;</span>, <span class="at">res =</span> <span class="dv">30</span>)</span>
<span id="cb137-2"><a href="spatial-data-in-r.html#cb137-2" aria-hidden="true" tabindex="-1"></a>snow_proj</span></code></pre></div>
<pre><code>## class      : RasterBrick 
## dimensions : 389, 345, 134205, 2  (nrow, ncol, ncell, nlayers)
## resolution : 30, 30  (x, y)
## extent     : 228559.8, 238909.8, 4032145, 4043815  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=NAD83 +units=m +no_defs 
## source     : memory
## names      : snow_20190223.1, snow_20190223.2 
## min values :       -8.835303,      -49.926375 
## max values :        23.99968,       157.71859</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="spatial-data-in-r.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stack</span>(elev_proj_2, snow_proj)</span></code></pre></div>
<p><code>Error in compareRaster(x) : different extent</code></p>
<p>Furthermore, there’s something else happening when rasters are projected. Let’s double-check the help file, <code>?projectRaster</code>. It looks like there’s another argument called <code>method</code> that defaults to <code>"bilinear"</code>. If you scroll down to the details of <code>method</code>, it says it can either take <code>ngb</code> (or nearest neighbor) or <code>bilinear</code> (or bilinear interpolation). Ok…well what does that mean? Bilinear interpretation is basically a way of estimating a value in between two other values. Nearest neighbor essentially picks the exact value of a point that’s closest to the focal point.</p>
<p>This essentially means that when you use <code>projectRaster</code>, the raster cells are being warped and shifted slightly, so R can’t just simply move the entire raster over, but it needs to know how to estimate the cell values in their new location and new resolution. So should it estimate a value in between two cell values or pick the actual value of the cell it’s closest to? Either way, this will slighlty adjust the data:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="spatial-data-in-r.html#cb140-1" aria-hidden="true" tabindex="-1"></a>elev_bilinear <span class="ot">&lt;-</span> <span class="fu">projectRaster</span>(elev, <span class="at">crs =</span> <span class="st">&quot;+init=epsg:26912&quot;</span>, <span class="at">res =</span> <span class="dv">30</span>, <span class="at">method =</span> <span class="st">&quot;bilinear&quot;</span>)</span>
<span id="cb140-2"><a href="spatial-data-in-r.html#cb140-2" aria-hidden="true" tabindex="-1"></a>elev_ngb <span class="ot">&lt;-</span> <span class="fu">projectRaster</span>(elev, <span class="at">crs =</span> <span class="st">&quot;+init=epsg:26912&quot;</span>, <span class="at">res =</span> <span class="dv">30</span>, <span class="at">method =</span> <span class="st">&quot;ngb&quot;</span>)</span>
<span id="cb140-3"><a href="spatial-data-in-r.html#cb140-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-4"><a href="spatial-data-in-r.html#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check the spread of values in the orginal raster</span></span>
<span id="cb140-5"><a href="spatial-data-in-r.html#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">values</span>(elev))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   645.8   798.5   869.5   864.4   932.0  1137.7</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="spatial-data-in-r.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the spread of values in the raster estimated with bilinear </span></span>
<span id="cb142-2"><a href="spatial-data-in-r.html#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">values</span>(elev_bilinear))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##   645.9   798.4   869.5   864.4   932.1  1137.3   13855</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="spatial-data-in-r.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the spread of values in the raster estimated with nearest neighbor </span></span>
<span id="cb144-2"><a href="spatial-data-in-r.html#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">values</span>(elev_ngb))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##   646.0   798.5   869.5   864.4   932.0  1137.7   13855</code></pre>
<p>There’s no right or wrong answer on which method you pick. The <code>projectRaster</code> help file recommends using <code>bilinear</code> for continuous rasters (like this elevation raster we’re working with) and <code>ngb</code> for categorical rasters (in fact, you probably <em>shouldn’t</em> use <code>bilinear</code> for categorical rasters because it will pick a value that’s in between two values which aren’t real numbers, but are actually stand-ins for a category). In my work I use <code>ngb</code> for continous rasters as well, so I’m going to use that for these examples, but <code>bilinear</code> is valid to use as well. (Again, as with everything, it depends on your analysis and your system.)</p>
<p>One thing to keep in mind with projecting rasters is that <strong>you should not over-project and re-sample your rasters over and over again</strong>. Imagine printing a picture and then making a copy of that printed picture. And then making a copy of the copy. And then a copy of that <em>that</em> copy. Over and over again. Eventually you end up with a warped image that only vaguely resembles the original image. A similar thing can happen if you project and re-sample your rasters even more than once.</p>
<p>In contrast, there is no issue with projecting and re-projecting your vector data over and over again.</p>
<p>Ok, so now that we know the dangers of projecting rasters, what <strong>is</strong> the best way project a raster? I recommend (and <code>projectRaster</code> also recommends) creating a template raster and using that template as a mold for all of your rasters. (<em>hint: this is where it comes in handy to know how to make a blank raster</em>)</p>
<p>So let’s create a template raster with our desired CRS, cell resolution, and extent. To choose the cell resolution, I recommend picking your set of rasters with the smallest resolution (but keep in mind that this will affect disk space and computation time, so again there’s no right or wrong answer). In this case, elevation (30mX30m) has a smaller resolution than snow (1kmX1km). The extent should be the min and max area of focus, such as your study area.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="spatial-data-in-r.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a blank raster with desired parameters. We don&#39;t need to add any values to it</span></span>
<span id="cb146-2"><a href="spatial-data-in-r.html#cb146-2" aria-hidden="true" tabindex="-1"></a>template <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="at">crs =</span> <span class="st">&quot;+init=epsg:26912&quot;</span>, <span class="at">resolution =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">30</span>),</span>
<span id="cb146-3"><a href="spatial-data-in-r.html#cb146-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xmn =</span> <span class="dv">228560</span>, <span class="at">xmx =</span> <span class="dv">238910</span>, <span class="at">ymn =</span> <span class="dv">4032145</span>, <span class="at">ymx =</span> <span class="dv">4043815</span>)</span>
<span id="cb146-4"><a href="spatial-data-in-r.html#cb146-4" aria-hidden="true" tabindex="-1"></a>template</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 389, 345, 134205  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 228560, 238910, 4032145, 4043815  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=NAD83 +units=m +no_defs</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="spatial-data-in-r.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use the template to project our rasters</span></span>
<span id="cb148-2"><a href="spatial-data-in-r.html#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="co"># from = focal raster</span></span>
<span id="cb148-3"><a href="spatial-data-in-r.html#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="co"># to = the raster object with the desired parameters</span></span>
<span id="cb148-4"><a href="spatial-data-in-r.html#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="co"># method = the method to compute new values </span></span>
<span id="cb148-5"><a href="spatial-data-in-r.html#cb148-5" aria-hidden="true" tabindex="-1"></a>elev_proj_template <span class="ot">&lt;-</span> <span class="fu">projectRaster</span>(<span class="at">from =</span> elev, <span class="at">to =</span> template, <span class="at">method =</span> <span class="st">&quot;ngb&quot;</span>)</span>
<span id="cb148-6"><a href="spatial-data-in-r.html#cb148-6" aria-hidden="true" tabindex="-1"></a>snow_proj_template <span class="ot">&lt;-</span> <span class="fu">projectRaster</span>(<span class="at">from =</span> snow_stack, <span class="at">to =</span> template, <span class="at">method =</span> <span class="st">&quot;ngb&quot;</span>)</span>
<span id="cb148-7"><a href="spatial-data-in-r.html#cb148-7" aria-hidden="true" tabindex="-1"></a>elev_proj_template</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 389, 345, 134205  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 228560, 238910, 4032145, 4043815  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=NAD83 +units=m +no_defs 
## source     : memory
## names      : elevation 
## values     : 645.9824, 1137.67  (min, max)</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="spatial-data-in-r.html#cb150-1" aria-hidden="true" tabindex="-1"></a>snow_proj_template</span></code></pre></div>
<pre><code>## class      : RasterBrick 
## dimensions : 389, 345, 134205, 2  (nrow, ncol, ncell, nlayers)
## resolution : 30, 30  (x, y)
## extent     : 228560, 238910, 4032145, 4043815  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=NAD83 +units=m +no_defs 
## source     : memory
## names      : snow_20190223.1, snow_20190223.2 
## min values :               0,               0 
## max values :              24,             150</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="spatial-data-in-r.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now we can stack them! This way we know for sure that all cells align with every layer</span></span>
<span id="cb152-2"><a href="spatial-data-in-r.html#cb152-2" aria-hidden="true" tabindex="-1"></a>stack <span class="ot">&lt;-</span> <span class="fu">stack</span>(elev_proj_template, snow_proj_template)</span>
<span id="cb152-3"><a href="spatial-data-in-r.html#cb152-3" aria-hidden="true" tabindex="-1"></a>stack</span></code></pre></div>
<pre><code>## class      : RasterStack 
## dimensions : 389, 345, 134205, 3  (nrow, ncol, ncell, nlayers)
## resolution : 30, 30  (x, y)
## extent     : 228560, 238910, 4032145, 4043815  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=NAD83 +units=m +no_defs 
## names      : elevation, snow_20190223.1, snow_20190223.2 
## min values :  645.9824,          0.0000,          0.0000 
## max values :   1137.67,           24.00,          150.00</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="spatial-data-in-r.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stack)</span></code></pre></div>
<p><img src="_main_files/figure-html/createTemp-1.png" width="672" /></p>
<p>Right now the bands’ names (besides “elevation”) are not very descriptive, but we can change their names so that we can more easily remember which band is which. In this case, band 1 is elevation, band 2 is SWE, and band 3 is snow depth. To change the band names, we’ll use the function <code>names()</code></p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="spatial-data-in-r.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(stack) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;elevation&quot;</span>, <span class="st">&quot;swe&quot;</span>, <span class="st">&quot;snow_depth&quot;</span>)</span>
<span id="cb155-2"><a href="spatial-data-in-r.html#cb155-2" aria-hidden="true" tabindex="-1"></a>stack</span></code></pre></div>
<pre><code>## class      : RasterStack 
## dimensions : 389, 345, 134205, 3  (nrow, ncol, ncell, nlayers)
## resolution : 30, 30  (x, y)
## extent     : 228560, 238910, 4032145, 4043815  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=NAD83 +units=m +no_defs 
## names      : elevation,      swe, snow_depth 
## min values :  645.9824,   0.0000,     0.0000 
## max values :   1137.67,    24.00,     150.00</code></pre>
</div>
<div id="save-a-raster" class="section level3 hasAnchor" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Save a raster<a href="spatial-data-in-r.html#save-a-raster" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To save a raster we’ll use the function <code>writeRaster</code>. We need to include the raster object that we’re saving, the full file name (including the directory <strong>but not the file extension</strong>), and the format (i.e. the file type) we want to save the raster as.</p>
<p>The two most common formats are <code>raster</code> (which creates two files with the extensions .gri and .grd) &amp; <code>GTiff</code> (GeoTIFF, which creates a file with the extension .tif). I personally use GeoTIFF’s, but a pro for using <code>raster</code> is that it saves the name of the raster layers that are in a stack.</p>
<p>(You can also check <code>writeFormats()</code> for other formats to save a raster.)</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="spatial-data-in-r.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(stack, <span class="st">&quot;Data/Examples/elev_snow_stack&quot;</span>, <span class="at">format =</span> <span class="st">&quot;GTIFF&quot;</span>)</span></code></pre></div>
<p>Note that some raster functions have optional arguments to add filenames and formats so that the funciton will automatically save the output after performing its function.</p>
</div>
<div id="your-turn-1" class="section level3 unnumbered hasAnchor">
<h3>Your Turn!<a href="spatial-data-in-r.html#your-turn-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the attached “worksheet”, there are some exerices to help you practice these concepts and functions. Try them out!</p>
<hr />
<p>Now that we know the basics of working with vector and raster data in R, let’s learn how to manipulate and perform computations on these spatial objects.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="gis-basics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="spatial-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://https://github.com/ronanhart/R_spatial_workshop/02-R_Spatial.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
